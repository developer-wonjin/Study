< 인덱스 구성 예측 > 

PK : ISBN

X1 : 출간일자 (+ 출판사명)

X2 : 출판사명 + 저자 + 제목 (또는 출판사명 + 제목 + 저자)

 

첫째, 도서정보 테이블이므로 PK 인덱스는 ISBN 단일 컬럼일 것으로 예상합니다. 업무적인 필요에 의해 PK가 두 개 이상 컬럼으로 구성돼 있더라도 ISBN이 선두인 결합 인덱스일 것입니다. ISBN이 선두 컬럼이라면 항상 빠른 조회가 가능합니다. 

 

둘째, 출간일자로 조회할 때는 출간일자가 선두 컬럼인 인덱스를 사용하고 있음을 짐작할 수 있습니다. 출간일자에 넓은 범위를 입력하고 조회하면 첫 번째 조회 시 오래 걸린다는 사실을 통해 알 수 있죠. 만약 Full Table Scan을 했다면 좁은 범위로 검색할 때도 느릴 것입니다. (첫 번째보다는 약간 빨라지겠지만) 

그리고 선두 컬럼이 출간일자이고, 뒤쪽 어딘가에 출판사명을 포함한 결합 인덱스일 가능성이 높습니다. 만약 ①출간일자 단일 컬럼 인덱스이거나 ②출간일자가 선두이면서 출판사명은 포함하지 않는 결합 인덱스일 경우, 테이블 랜덤 액세스가 많이 발생함으로 인해 두 번째 조회 시에도 느릴 수 있습니다. (첫 번째보다는 약간 빨라지겠지만) 

 

셋째, 마지막 인덱스는 출판사명을 선두로 저자와 제목을 포함한 인덱스일 가능성이 높습니다.  

인덱스 구성이 「출판사명 + 저자 + 제목」인 경우, 제목으로 검색하면 제목 조건절이 인덱스 필터로 처리되므로 비효율이 발생합니다. 인덱스 구성이 「출판사명 + 제목 + 저자」인 경우, 저자로 검색하면 저자 조건절이 인덱스 필터로 처리되므로 비효율이 발생합니다. 그럼에도 불구하고 항상 빠르게 조회된다는 사실을 통해 출판사별 평균 출간 도서량이 많지 않음을 알 수 있습니다. 출판사별 평균 출간 도서량이 많지 않으면(수천 권 이내), 테이블 랜덤 액세스를 발생하지 않게 인덱스를 구성하는 것만으로도 빠른 조회 가능합니다. 

 

< 개선 방안 >

인덱스를 3개로 유지한 상태에서 개선한다면, X1 인덱스를 아래와 같이 재구성하면 됩니다.  

 

PK : ISBN 

X1 : 출판사명 + 출간일자

X2 : 출판사명 + 저자 + 제목 (또는 출판사명 + 제목 + 저자)
     (※ 저자, 제목 중 가장 자주 사용하는 조건절 컬럼을 두 번째에 배치하면 좋습니다.)

 

출판사별 평균 출간 도서량이 많지 않다고 했으므로 아래와 같이 구성함으로써 인덱스 개수를 줄일 수 있습니다.  

 

PK : ISBN

X1 : 출판사명 + 출간일자 + 저자 + 제목
      (※ 출간일자, 저자, 제목 중 가장 자주 사용하는 조건절 컬럼을 두 번째에 배치하고, 남은 두 컬럼 간 순서는 자유롭게 배치)

 

조회 성능에 영향을 주지 않는 범위 내에서 인덱스 개수를 줄이는 것은 매우 큰 의미가 있습니다. 데이터 저장 성능에 영향을 미치기 때문입니다. 인덱스 설계가 어려운 이유는 개별 쿼리 성능뿐만 아니라 그 개수를 최소화함으로써 DML 부하를 줄여야 한다는 데 있습니다. 친절한 SQL 튜닝 230~237페이지를 참고하시기 바라며, 인덱스 설계는 공식만으로 되지 않는다는 사실을 꼭 기억하시면 좋겠습니다. 