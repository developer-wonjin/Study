create table 绊按
as
select 
    rownum 绊按ID
  , dbms_random.string('U', 10) 绊按疙
  , mod(rownum, 10) + 1 绊按殿鞭
  , to_char(to_date('20090101','yyyymmdd') + (rownum-1), 'yyyymmdd') 啊涝老
from   dual
connect by level <= 1000;

exec dbms_stats.gather_table_stats(user, '绊按');


set autotrace traceonly exp;

select /*+ full(绊按) parallel(绊按 2) */
       绊按ID, 绊按疙, 绊按殿鞭
from   绊按
order by 绊按疙 ;

set autotrace off;

select /*+ full(绊按) parallel(绊按 2) */
       绊按ID, 绊按疙, 绊按殿鞭
from   绊按
order by 绊按疙 ;

break on dfo_no on tq_id on server_type;

select tq_id, server_type, process, num_rows, bytes, waits
from   v$pq_tqstat
order by
    dfo_number
  , tq_id
  , decode(substr(server_type, 1, 4),'Rang', 1, 'Prod', 2, 'Cons', 3)
  , process;


set autotrace traceonly exp;

select /*+ full(绊按) parallel(绊按 2) */
       绊按疙, count(*)
from   绊按
group by 绊按疙 ;


set autotrace off;

select /*+ full(绊按) parallel(绊按 2) */
       绊按疙, count(*)
from   绊按
group by 绊按疙 ;

select tq_id, server_type, process, num_rows, bytes, waits
from   v$pq_tqstat
order by
    dfo_number
  , tq_id
  , decode(substr(server_type, 1, 4),'Rang', 1, 'Prod', 2, 'Cons', 3)
  , process;

set autotrace traceonly exp;

select /*+ full(绊按) parallel(绊按 2) */
       绊按殿鞭, count(*)
from   绊按
group by 绊按殿鞭 ;


set autotrace off

select column_name
     , num_distinct
     , num_nulls
     , 1/num_distinct selectivity
     , round(1/num_distinct * t.num_rows, 2) cardinality
from   user_tables t, user_tab_columns c
where  t.table_name = '绊按'
and    c.table_name = t.table_name
order by column_id ;


select /*+ full(绊按) parallel(绊按 2) */
       绊按殿鞭, count(*)
from   绊按
group by 绊按殿鞭 ;


select tq_id, server_type, process, num_rows, bytes, waits
from   v$pq_tqstat
order by
    dfo_number
  , tq_id
  , decode(substr(server_type, 1, 4),'Rang', 1, 'Prod', 2, 'Cons', 3)
  , process;